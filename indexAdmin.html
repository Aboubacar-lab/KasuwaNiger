<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Ma Boutique</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script>
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "firebase/app";
  import { getAnalytics } from "firebase/analytics";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries
  
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCbUiCh3sg_nBLhfVLhW0JpXcYvW3Ruh40",
    authDomain: "boutiqueniger-1216f.firebaseapp.com",
    projectId: "boutiqueniger-1216f",
    storageBucket: "boutiqueniger-1216f.firebasestorage.app",
    messagingSenderId: "80354781472",
    appId: "1:80354781472:web:cbea13865d70928ef50f45",
    measurementId: "G-X35P9HDWQ2"
  };
  
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
  
</head>
<body>
  <div class="container py-4">
    <h2 class="mb-4">Gestion des Produits</h2>

    <!-- Formulaire -->
    <form id="product-form" class="row g-3 mb-4">
      <input type="hidden" id="productId">
      <div class="col-md-3">
        <input type="text" id="name" class="form-control" placeholder="Nom du produit" required>
      </div>
      <div class="col-md-2">
        <input type="number" id="price" class="form-control" placeholder="Prix (FCFA)" required>
      </div>
      <div class="col-md-3">
        <input type="file" id="image" class="form-control" accept="image/*">
      </div>
      <div class="col-md-2">
        <select id="available" class="form-control">
          <option value="true">Disponible</option>
          <option value="false">Rupture</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Enregistrer</button>
      </div>
    </form>

    <!-- Tableau -->
    <table class="table table-bordered text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>Image</th>
          <th>Nom</th>
          <th>Prix</th>
          <th>Disponibilit√©</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="product-table"></tbody>
    </table>
  </div>

  <script type="module">
    // üîπ Configuration Firebase (√† remplacer par les tiennes)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "TA_CLE_API",
      authDomain: "TON_PROJET.firebaseapp.com",
      projectId: "TON_PROJET",
      storageBucket: "TON_PROJET.appspot.com",
      messagingSenderId: "XXX",
      appId: "XXX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productsRef = collection(db, "products");

    const table = document.getElementById("product-table");
    const form = document.getElementById("product-form");

    // üîπ Affichage en temps r√©el
    onSnapshot(productsRef, (snapshot) => {
      table.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const p = docSnap.data();
        table.innerHTML += `
          <tr>
            <td><img src="${p.image}" width="80"></td>
            <td>${p.name}</td>
            <td>${p.price} FCFA</td>
            <td><span class="badge bg-${p.available ? "success" : "danger"}">${p.available ? "Disponible" : "Rupture"}</span></td>
            <td>
              <button class="btn btn-warning btn-sm" onclick="editProduct('${docSnap.id}', '${p.name}', '${p.price}', '${p.available}', '${p.image}')">Modifier</button>
              <button class="btn btn-danger btn-sm" onclick="deleteProduct('${docSnap.id}')">Supprimer</button>
            </td>
          </tr>`;
      });
    });

    // üîπ Ajouter / Modifier un produit
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("productId").value;
      const name = document.getElementById("name").value;
      const price = document.getElementById("price").value;
      const available = document.getElementById("available").value === "true";
      const fileInput = document.getElementById("image");
      let imageBase64 = "";

      if (fileInput.files[0]) {
        imageBase64 = await toBase64(fileInput.files[0]);
      }

      const product = { name, price, available, image: imageBase64 || "" };

      if (id) {
        await updateDoc(doc(db, "products", id), product);
      } else {
        await addDoc(productsRef, product);
      }

      form.reset();
      document.getElementById("productId").value = "";
    });

    // üîπ Modifier
    window.editProduct = (id, name, price, available, image) => {
      document.getElementById("productId").value = id;
      document.getElementById("name").value = name;
      document.getElementById("price").value = price;
      document.getElementById("available").value = available;
    };

    // üîπ Supprimer
    window.deleteProduct = async (id) => {
      await deleteDoc(doc(db, "products", id));
    };

    // Convertir image en base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => reject(error);
      });
    }
  </script>
</body>
</html>
